@if (shoppingListState(); as state) {
  @if (state.loading) {
    <mat-spinner data-testid="loading-spinner"></mat-spinner>
  } @else if (state.data) {
    <mat-card data-testid="shopping-list-details-container">
      <mat-card-header>
        <mat-card-title data-testid="shopping-list-title">
          {{ state.data.name }}
        </mat-card-title>
        <mat-card-subtitle>Created: {{ state.data.created_at | date }}</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <mat-list data-testid="shopping-list-items">
          @for (item of state.data.items; track item.id) {
            <mat-list-item [attr.data-testid]="'list-item-' + item.id">
              <div class="item-container">
                <mat-checkbox [checked]="item.is_checked">
                  {{ item.product_name }} - {{ item.quantity }} {{ item.unit }}
                </mat-checkbox>
                <div class="item-actions">
                  <mat-chip-set>
                    <mat-chip [attr.data-testid]="'category-chip-' + item.id" color="accent">
                      {{ getCategoryName(item.category_id, state.categories) }}
                    </mat-chip>
                  </mat-chip-set>
                  <button
                    mat-icon-button
                    color="warn"
                    (click)="deleteItem(item.id)"
                    [attr.data-testid]="'delete-item-' + item.id"
                    aria-label="Delete item"
                  >
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </div>
            </mat-list-item>
          }
        </mat-list>
      </mat-card-content>
    </mat-card>
  } @else {
    <mat-card>
      <mat-card-content>
        <p>Shopping list not found</p>
      </mat-card-content>
    </mat-card>
  }
}
